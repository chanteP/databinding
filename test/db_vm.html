<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="content-language" content="zh-CN" />
        
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
        <meta content="yes" name="apple-mobile-web-app-capable" />
        <meta content="black" name="apple-mobile-web-app-status-bar-style" />
        <meta content="telephone=no" name="format-detection" />
        
        <title>vm测试，name:{{form.name}}</title>
        
        <!--        <link rel="shortcut icon" href="/favicon.ico" /> -->
        <!-- <link href='http://fonts.googleapis.com/css?family=Roboto:400,100' rel='stylesheet' type='text/css'> -->
        <script src="./zepto.min.js"></script>
        <script src="./jquery.hammer.min.js"></script>
        <script src="../build/databind.js"></script>
    </head>
    <body>
        <div id="wrapper">
        <div>
            <input vm-model="calc.p1">+<input vm-model="calc.p2">=<span>{{calc.p1 - -calc.p2}}</span>=<span>{{calc.p3}}</span>
        </div>
        <form vm-bind="form">
            <div>
                <label>姓名</label><input name="name" vm-model="name" value="{{name}}">
                <span style="display:{{name['length'] >= 12 ? 'block' : 'none'}};color:#c00;">名字哪有那么长的啊</span>
            </div>
            <div>
                <label>性别</label>
                <label><input type="radio" name="sex" vm-model="sex" value="male" checked="{{sex}}">男</label>
                <label><input type="radio" name="sex" vm-model="sex" value="female" checked="{{sex}}">女</label>
            </div>
            <div>
                <label>职业</label>
                <label><input type="checkbox" name="job" vm-model="job" value="m" checked="{{job}}">法师</label>
                <label><input type="checkbox" name="job" vm-model="job" value="s" checked="{{job}}">剑士</label>
            </div>
            <div>
                介绍<textarea name="intro" vm-model="intro" value="{{intro}}"></textarea>
            </div>
        </form>
        </div>
        <hr >
        <div id="info" vm-bind="form">
            <p>{{name['length']}}</p>
            <p>姓名是{{name == '' ? '无' : name}}, {{sex == 'male' ? '基佬' : '妹纸'}}, 职业 {{job | map({"m":"法师","s":"剑士"};,)}}</p>
            <p>{{intro | text-overflow}}</p><span style="display:{{intro['length'] > 16 ? 'block' : 'none'}};color:#c00;">超过16个字了卧槽</span>
        </div>
        <div>{{form.table['length']}}</div>
        <button id="tableP">+</button>
        <button id="tableM">-</button>
        <table vm-bind="form">
            <tr vm-list="form.table">
                <td>{{.index}}</td>
                <td>{{name}}</td>
                <td>{{id}}</td>
            </tr>
        </table>
        <hr >
        <div id="formData"></div>
        <script type="text/javascript">
            DataBind.config({mode:0});
            var vm = DataBind.root;
            var exp = DataBind.expression;

            var newL = function(){
                return {
                    id : Date.now(),
                    name : String.fromCharCode((Math.random()*43244)|0)
                }
            }
            var formData = {
                name : {
                    $value : 'dsfgdfg',
                    $set : function(v){
                        return v.length > 12 ? v.slice(0, 12) : v;
                    }
                },
                sex : 'female',
                job : 's',
                intro : '123123123cfd',
                table : [
                    newL(),
                    newL(),
                    newL(),
                    newL(),
                    newL()
                ]
            };

            new DataBind('form', formData).observe('', function(value, ov, e){
                // console.log('change',value, ov, e)
                document.getElementById('formData').innerHTML = JSON.stringify(vm.form);
                // console.log(JSON.stringify(vm.form));
            });

            new DataBind('calc.p3', {
                $get : function(){
                    return +this.p1 + +this.p2;
                }
            });

            tableP.onclick = function(){
                formData.table.push(newL())
            }
            tableM.onclick = function(){
                formData.table.pop();
            }

            console.log(formData)

            // tableP.onclick();tableP.onclick();

        </script>
    </body>
</html>