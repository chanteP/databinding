<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="content-language" content="zh-CN" />
        
        <title>name:{{form.name}} vm杂七杂八的测试</title>
        
        <script src="../build/databind.js"></script>
        <!-- // <script src="./jquery.hammer.min.js"></script> -->
    </head>
    <body>
        <div id="wrapper">
        <div>{{timestamp}}</div>
        <div>
            <input vm-model="calc.p1">+<input vm-model="calc.p2">=<span>{{calc.p1-calc.p2 }}</span>=<span>{{calc.p3}}</span>
        </div>
        <form vm-bind="form">
            <div>
                <label>姓名</label><input name="name" vm-model="name" value="{{name}}">
                <span style="display:{{name['length'] >= 12 ? 'block' : 'none'}};color:#c00;">名字哪有那么长的啊</span>
            </div>
            <div>
                <select value="{{select}}" vm-model="select">
                    <option vm-bind="form" vm-list="tr in table" value="{{tr.id}}" selected="{{tr.id}}" index="{{$.index}}">{{tr.name}}</option>
                </select>
                <span>{{select}}</span>
            </div>
            <div>
                <label>性别</label>
                <label><input type="radio" name="sex" vm-model="sex" value="male" checked="{{sex}}">男</label>
                <label><input type="radio" name="sex" vm-model="sex" value="female" checked="{{sex}}">女</label>
            </div>
            <div>
                <label>职业</label>
                <label><input type="checkbox" name="job" vm-model="job" value="m" checked="{{job}}">法师</label>
                <label><input type="checkbox" name="job" vm-model="job" value="s" checked="{{job}}">剑士</label>
            </div>
            <div>
                介绍<textarea name="intro" vm-model="intro" value="{{intro}}"></textarea>
            </div>
        </form>
        </div>
        <hr >
        <div id="info" vm-bind="form">
            <p>{{name | size}}</p>
            <p>姓名是{{name == '' ? '无' : name}}, {{sex == 'male' ? '基佬' : '妹纸'}}, 职业 {{job | split | map:"{\"m\":\"法师\",\"s\":\"剑士\"}" | join }}</p>
            <p>{{intro | append}}</p><span style="display:{{intro.length > 16 ? 'block' : 'none'}};color:#c00;">超过16个字了卧槽</span>
        </div>
        <div>{{form.table | size}}</div>
        <button id="tableP">+</button>
        <button id="tableM">-</button>
        <table vm-bind="form">
            <tr vm-list="tr in table">
                <td>{{$.index}} & {{sex == 'male' ? '基佬' : '妹纸'}} & {{name}}</td>
                <td>{{tr.name}}</td>
                <td>{{tr.id}}</td>
            </tr>
        </table>
        <hr >
        <div id="formData"></div>
        <script type="text/javascript">
            DataBind.config({
                mode:0,
                initDOM:true,
                DOMPrefix:'vm-'
            })
            var vm = DataBind.root;
            // var exp = DataBind.expression;

            var newL = function(){
                return {
                    id : Date.now(),
                    name : String.fromCharCode((Math.random()*43244)|0)
                }
            }
            var formData = {
                name : {
                    $value : 'dsfgdfg',
                    $set : function(v){
                        return v.length > 12 ? v.slice(0, 12) : v;
                    }
                },
                sex : 'female',
                job : 's',
                intro : '123123123cfd',
                select : '',
                table : (function(num){
                    var arr = [];
                    while(num--){
                        arr.push(newL())
                    }
                    return arr
                })(50)
            };

            new DataBind('form', formData)
            new DataBind('calc.p3', {
                $get : function(){
                    return +this.p1 + +this.p2;
                }
            });
            var cur = Date.now();
            new DataBind('timestamp', cur);

            tableP.onclick = function(){
                formData.table.push(newL())
            }
            tableM.onclick = function(){
                formData.table.pop();
            }
            // DataBind.scan(document.documentElement, 1)
            console.log(formData)
            setInterval(function(){
                vm.timestamp = ((Date.now() - cur) / 1000).toFixed(1);
            }, 50);

        </script>
    </body>
</html>